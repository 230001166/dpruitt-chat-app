<!DOCTYPE html>
<html>

<title>Simple Chat App</title>
<h1>Simple Chat App</h1>

<p id = "time">Server time</p>

<label for="username">Enter a username (4 to 16 characters):</label>
<input type="text" id="username" name="username" required
       minlength="4" maxlength="16" size="10">
<button id="submitName" onclick="setUsername ()">Submit</button>
<br>
<label for="message">Enter a message here:</label>

<input type="text" id="message" name="message" required
       minlength="1" maxlength="256" size="10">
<button id="submitMessage" onclick="sendMessage ()">Submit</button>

<style>
	body {
		font-family: arial;
		font-weight: bold;
		font-size: 22px;
		color: whitesmoke;
		background-color: indianred;
	}
	.message {
		font-size: 16px;
		font-weight: normal;
	}
</style>
<script>
		var HOST = location.origin.replace(/^http/, "ws");
		var ws = new WebSocket (HOST);
		let uniqueID = 0;
		let username = "guest";

		ws.onmessage = function(event) {
			let message = JSON.parse(event.data);
			console.log (message.type);
			if (message.type === "time") {
				let time = document.getElementById ("time");
				time.innerHTML = message.text;
			} else {
				let newMessage = document.createElement ('p');
				newMessage.textContent = message.text;
				newMessage.className = "message";
				if (message.type === "serverMessage") {
					newMessage.style.cssText = "font-weight: bold"; 
				}
				document.body.appendChild (newMessage);
			}
		};

		setUsername = function () {
			username = document.getElementById ("username").value;
		}

		sendMessage = function () {
			let chatMessage = document.getElementById ("message").value;
			let message = {
				username, username,
				text: chatMessage,
			}
			ws.send (JSON.stringify (message));
		}
	  </script>
</html>